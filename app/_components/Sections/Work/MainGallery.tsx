"use client";

import { Card } from "../../UI/Layout/Card";

interface Project {
  id: number;
  title: string;
  categories: string[];
  year: string;
  imageUrl: string;
  galleryImages?: string[];
  text?: string;
}

export interface MainGalleryProps {
  selectedCategories: string[];
  setSelectedCategories: React.Dispatch<React.SetStateAction<string[]>>;
  filteredProjects: Project[];
  sortedVisibleCategories: [string, number][];
  toggleCategory: (cat: string) => void;
  onCardClick: (index: number, project: Project) => void;
}

export function MainGallery({
  selectedCategories,
  setSelectedCategories,
  filteredProjects,
  sortedVisibleCategories,
  toggleCategory,
  onCardClick,
}: MainGalleryProps) {

  return (
    <>
      <div className="pt-12 pb-4 px-0 rounded-xs flex flex-wrap gap-4 w-full">
        <div className="xl:w-1/2 text-sm sm:text-base py-2">
          <div>
            <button
              onClick={() => { setSelectedCategories([]); }}
              className={`mr-2 cursor-crosshair transition-opacity ${selectedCategories.length === 0 ? "text-foreground" : "text-foreground/50"}`}
            >
              PROJECTS [{filteredProjects.length}]
            </button>
          </div>
          <div className="flex flex-wrap gap-0 mt-2">
            {sortedVisibleCategories.map(([category, count]) => {
              const categoryStr = String(category);
              const isSelected = selectedCategories.includes(categoryStr);
              const isUnselectable = count === 0;
              return (
                <span key={categoryStr} className="inline-flex items-center text-sm sm:text:base">
                  <button
                    onClick={() => !isUnselectable && toggleCategory(categoryStr)}
                    disabled={isUnselectable}
                    className={`pr-1 py-1 rounded transition-colors cursor-crosshair text-foreground ${isSelected ? "underline font-semibold" : ""} ${isUnselectable ? "opacity-30 cursor-not-allowed" : "hover:bg-background/10"}`}
                  >
                    {categoryStr} <span className="text-foreground/60">[{count}]</span>
                  </button>
                </span>
              );
            })}
          </div>
        </div>
      </div>
      <div className="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-2 px-0">
        {filteredProjects.map((project, idx) => (
          <div key={project.id} className="relative group">
            <Card
              key={project.id}
              categories={project.categories}
              imageUrl={project.imageUrl}
              galleryImages={project.galleryImages}
              year={project.year}
              title={project.title}
              imageSizes="(min-width: 1280px) 25vw, (min-width: 768px) 33vw, 50vw"
              imageWidth={900}
              imageHeight={1125}
              imageQuality="auto:eco"
              handleOnClick={() => onCardClick(idx, project)}
            />
            <div className="absolute inset-x-0 top-8 px-4 group-hover:opacity-100 opacity-0 flex flex-col group-hover:mt-2 z-60 transition-all duration-500 pointer-events-none max-w-full">
              <h3 className="tracking-tight text-background wrap-break-word">
                {project.title}
              </h3>
              <div className="flex flex-wrap gap-x-4 gap-y-1 text-background wrap-break-word max-w-full">
                <span className="wrap-break-word max-w-full">[{project.categories.join(', ')}]</span>
                <span>{project.year}</span>
              </div>
            </div>
          </div>
        ))}
      </div>
    </>
  );
}
